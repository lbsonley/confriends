{"version":3,"sources":["../server/server.js"],"names":["jwt","require","jwks","cors","path","logger","config","app","db","connect","then","connection","listen","catch","err","use","json","urlencoded","extended","static","join","__dirname","authCheck","secret","expressJwtSecret","cache","rateLimit","jwksRequestsPerMinute","jwksUri","process","env","AUTH0_DOMAIN","audience","AUTH0_AUDIENCE","issuer","algorithms","getMongoId","idString","res","error","status","message","deleteConferenceAttendees","req","collection","params","collectionName","deleteMany","eventId","attendees","deleteConference","deleteOne","_id","event","getEventAttendees","find","toArray","getOneEvent","limit","next","delete","userId","findOneAndDelete","put","body","updateOne","$set","name","procurementLink","approved","findOne","attendee","website","date","city","country","description","upsert","responseEvent","responseAttendee","get","events","send","sendFile"],"mappings":"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","file":"server.js","sourcesContent":["import 'babel-polyfill';\nimport express from 'express';\nimport bodyParser from 'body-parser';\nimport { MongoClient, ObjectId } from 'mongodb';\n\nconst jwt = require('express-jwt');\nconst jwks = require('jwks-rsa');\nconst cors = require('cors');\nconst path = require('path');\nconst logger = require('debug')('expressServer');\nrequire('dotenv').config();\n\nconst app = express();\nlet db;\n\nMongoClient.connect('mongodb://localhost/confriends')\n  .then(connection => {\n    db = connection;\n    app.listen(3001, () => logger('running on port 3001'));\n  })\n  .catch(err => logger('Error connecting to DB:', err));\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\napp.use(cors());\n\n// Serve static files from the React app\napp.use(express.static(path.join(__dirname, '../client/build')));\n\n// eslint-disable-next-line no-unused-vars\nconst authCheck = jwt({\n  secret: jwks.expressJwtSecret({\n    cache: true,\n    rateLimit: true,\n    jwksRequestsPerMinute: 5,\n    // YOUR-AUTH0-DOMAIN name e.g prosper.auth0.com\n    jwksUri: `https://${process.env.AUTH0_DOMAIN}/.well-known/jwks.json`,\n  }),\n  // This is the identifier we set when we created the API\n  audience: `https://${process.env.AUTH0_AUDIENCE}`,\n  issuer: `https://${process.env.AUTH0_DOMAIN}/`,\n  algorithms: ['RS256'],\n});\n\n// helper function\n\nconst getMongoId = (idString, res) => {\n  // convert the id string to a MongoDB ObjectId\n  try {\n    return ObjectId(idString);\n  } catch (error) {\n    res.status(422).json({ message: `Invalid issue ID format: ${error}` });\n  }\n};\n\nconst deleteConferenceAttendees = (req, res) => {\n  db\n    .collection(req.params.collectionName)\n    .deleteMany({ eventId: req.params.eventId })\n    .then(attendees => {\n      logger('deleteConferenceAttendees');\n      res.json({ attendees });\n    })\n    .catch(err => {\n      logger('error deleting conference attendees: ', err);\n      res.json({ message: `Could not delete conference attendees: ${err}` });\n    });\n};\n\nconst deleteConference = (req, res) => {\n  const eventId = getMongoId(req.params.eventId);\n\n  db\n    .collection(req.params.collectionName)\n    .deleteOne({ _id: eventId })\n    .then(event => {\n      logger('deleteConference');\n      res.json({ event });\n    })\n    .catch(err => {\n      logger('Error deleting conference: ', err);\n      res.json({ message: `Could not delete conference: ${err}` });\n    });\n};\n\nconst getEventAttendees = (req, res) => {\n  const { params } = req;\n\n  db\n    .collection('attendees')\n    .find({\n      eventId: params.eventId,\n    })\n    .toArray()\n    .then(attendees => {\n      logger('getEventAttendees response: ', attendees);\n      res.json({ attendees });\n    })\n    .catch(err => {\n      logger('error getting event attendees: ', err);\n      res.json({ message: `Could not get event attendees: ${err}` });\n    });\n};\n\nconst getOneEvent = (req, res) => {\n  const { params } = req;\n\n  const eventId = getMongoId(params.eventId, res);\n\n  db\n    .collection(params.collectionName)\n    .find({ _id: eventId })\n    .limit(1)\n    .next()\n    .then(event => {\n      logger('getOneEvent response', event);\n      res.json({ event });\n    })\n    .catch(err => {\n      logger('error getting event: ', err);\n      res.json({ message: `Could not get event: ${err}` });\n    });\n};\n\n/**\n * Delete API\n */\n\n// delete an attendee\napp.delete('/api/:collectionName/:eventId/:userId', (req, res) => {\n  const { eventId, userId } = req.params;\n  db\n    .collection(req.params.collectionName)\n    .findOneAndDelete({ eventId, userId }, err => {\n      if (err) {\n        logger('error deleting attendee: ', err);\n        res.json({ message: `Could not delete attendee: ${err}` });\n        return;\n      }\n      getEventAttendees(req, res);\n      // db\n      //   .collection(req.params.collectionName)\n      //   .find({ eventId })\n      //   .toArray()\n      //   .then(attendees => {\n      //     logger('attendees after delete', attendees);\n      //     res.json({ attendees });\n      //   })\n      //   .catch(error => {\n      //     logger('error getting attendees after delete: ', error);\n      //     res.json({\n      //       message: `Could not get updated attendee list: ${error}`,\n      //     });\n      //   });\n    });\n});\n\n// delete a conference\napp.delete('/api/:collectionName/:eventId', (req, res) => {\n  if (req.params.collectionName === 'attendees') {\n    deleteConferenceAttendees(req, res);\n  } else if (req.params.collectionName === 'conferences') {\n    deleteConference(req, res);\n  }\n});\n\n/**\n * Create API\n */\n\n// updating an event's attendee with new approval info\napp.put('/api/:collectionName/:eventId/:userId', (req, res) => {\n  logger('body', req.body);\n  db.collection(req.params.collectionName).updateOne(\n    // filter\n    { eventId: req.params.eventId, userId: req.body.userId },\n    // info to update\n    {\n      $set: {\n        eventId: req.body.eventId,\n        userId: req.body.userId,\n        name: req.body.name,\n        procurementLink: req.body.procurementLink,\n        approved: req.body.approved,\n      },\n    },\n    // callback\n    err => {\n      if (err) {\n        logger('error updating attendee: ', err);\n        res.json({ message: `Could not update attendee info: ${err}` });\n        return;\n      }\n      db\n        .collection(req.params.collectionName)\n        .findOne({ eventId: req.params.eventId, userId: req.body.userId })\n        .then(attendee => {\n          logger('updatedAttendee: ', attendee);\n          res.json(attendee);\n        });\n    },\n  );\n});\n\n// adding event to collection\napp.put('/api/:collectionName', (req, res) => {\n  logger('body', req.body);\n  const { name, website, date, city, country, description } = req.body;\n  db.collection(req.params.collectionName).updateOne(\n    // filter\n    {\n      website,\n    },\n    // data to update\n    {\n      name,\n      website,\n      date,\n      city,\n      country,\n      description,\n    },\n    // options\n    { upsert: true },\n    // callback\n    err => {\n      if (err) {\n        logger('error adding event to collection: ', err);\n        res.json({ message: `Could not add event: ${err}` });\n        return;\n      }\n      db\n        .collection(req.params.collectionName)\n        .findOne({ website })\n        .then(responseEvent => {\n          logger('response', responseEvent);\n          res.json(responseEvent);\n        });\n    },\n  );\n});\n\n// add attendee to event\napp.put('/api/:collectionName/:id', (req, res) => {\n  logger('body', req.body);\n  db.collection(req.params.collectionName).updateOne(\n    {\n      eventId: req.body.eventId,\n      userId: req.body.userId,\n    },\n    {\n      eventId: req.body.eventId,\n      userId: req.body.userId,\n      name: req.body.name,\n      procurementLink: req.body.procurementLink,\n      approved: req.body.approved,\n    },\n    { upsert: true },\n    err => {\n      if (err) {\n        logger('Error adding attendee: ', err);\n        res.json({ message: `Could not add attendee: ${err}` });\n        return;\n      }\n      db\n        .collection(req.params.collectionName)\n        .findOne({ eventId: req.body.eventId, userId: req.body.userId })\n        .then(responseAttendee => {\n          logger('response', responseAttendee);\n          res.json(responseAttendee);\n        });\n    }\n  );\n});\n\n/**\n * Read API\n */\n\n// endpoint for edit attendee page\n// each event attendee has a unique\n// entry in the database so we have to\n// filter on eventId and userId\napp.get('/api/:collectionName/:eventId/:userId', (req, res) => {\n  db\n    .collection(req.params.collectionName)\n    // find the attendee to edit\n    .findOne({ eventId: req.params.eventId, userId: req.params.userId })\n    .then(attendee => {\n      logger('sending', attendee);\n      res.json({ attendee });\n    });\n});\n\n// endpoint for event detail page\napp.get('/api/:collectionName/:eventId', (req, res) => {\n  if (req.params.collectionName === 'conferences') {\n    getOneEvent(req, res);\n  } else if (req.params.collectionName === 'attendees') {\n    getEventAttendees(req, res);\n  }\n});\n\n// endpoint for a list of events\napp.get('/api/:collectionName', (req, res) => {\n  db\n    .collection(req.params.collectionName)\n    .find()\n    .toArray()\n    .then(events => {\n      res.json({ events });\n    });\n});\n\napp.get('/api', (req, res) => {\n  res.send('Using the confriends REST API');\n});\n\n// The \"catchall\" handler: for any request that doesn't\n// match one above, send back React's index.html file.\napp.get('*', (req, res) => {\n  res.sendFile(path.join(`${__dirname}../client/build/index.html`));\n});\n"]}