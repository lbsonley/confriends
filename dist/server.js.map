{"version":3,"sources":["../server/server.js"],"names":["jwt","require","jwks","cors","path","logger","config","app","db","connect","then","connection","listen","catch","err","use","json","urlencoded","extended","static","join","__dirname","authCheck","secret","expressJwtSecret","cache","rateLimit","jwksRequestsPerMinute","jwksUri","process","env","AUTH0_DOMAIN","audience","AUTH0_AUDIENCE","issuer","algorithms","put","req","res","issueId","params","id","error","status","message","collection","collectionName","update","_id","$push","attendees","name","body","find","limit","next","savedEvent","console","log","get","event","toArray","events","send","sendFile"],"mappings":"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","file":"server.js","sourcesContent":["import 'babel-polyfill';\nimport express from 'express';\nimport bodyParser from 'body-parser';\nimport { MongoClient, ObjectId } from 'mongodb';\n\nconst jwt = require('express-jwt');\nconst jwks = require('jwks-rsa');\nconst cors = require('cors');\nconst path = require('path');\nconst logger = require('debug')('expressServer');\nrequire('dotenv').config();\n\nconst app = express();\nlet db;\n\nMongoClient.connect('mongodb://localhost/events')\n  .then(connection => {\n    db = connection;\n    app.listen(3001, () => logger('running on port 3001'));\n  })\n  .catch(err => logger('ERROR:', err));\n\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\napp.use(cors());\n\n// Serve static files from the React app\napp.use(express.static(path.join(__dirname, '../client/build')));\n\n// eslint-disable-next-line no-unused-vars\nconst authCheck = jwt({\n  secret: jwks.expressJwtSecret({\n    cache: true,\n    rateLimit: true,\n    jwksRequestsPerMinute: 5,\n    // YOUR-AUTH0-DOMAIN name e.g prosper.auth0.com\n    jwksUri: `https://${process.env.AUTH0_DOMAIN}/.well-known/jwks.json`,\n  }),\n  // This is the identifier we set when we created the API\n  audience: `https://${process.env.AUTH0_AUDIENCE}`,\n  issuer: `https://${process.env.AUTH0_DOMAIN}/`,\n  algorithms: ['RS256'],\n});\n\n// ** Create API **\n\n/**\n * endpoint for updating a record\n */\napp.put('/api/:collectionName/:id', (req, res) => {\n  let issueId;\n\n  // convert the id string to a MongoDB ObjectId\n  try {\n    issueId = ObjectId(req.params.id);\n  } catch (error) {\n    res.status(422).json({ message: `Invalid issue ID format: ${error}` });\n    return;\n  }\n\n  db.collection(req.params.collectionName).update(\n    { _id: issueId },\n    {\n      $push: {\n        attendees: { name: req.body.name, id: req.body.id },\n      },\n    },\n    () => {\n      db\n        .collection(req.params.collectionName)\n        .find({ _id: issueId })\n        .limit(1)\n        .next()\n        .then(savedEvent => {\n          console.log(savedEvent);\n          res.json(savedEvent);\n        })\n        .catch(err => {\n          console.log('error', err);\n          res.status.json({ message: `Error: ${err}` });\n        });\n    }\n  );\n});\n\n// ** Read API **\n\n/**\n * endpoint for event detail page\n */\napp.get('/api/:collectionName/:id', (req, res) => {\n  let issueId;\n\n  // convert the id string to a MongoDB ObjectId\n  try {\n    issueId = ObjectId(req.params.id);\n  } catch (error) {\n    res.status(422).json({ message: `Invalid issue ID format: ${error}` });\n    return;\n  }\n\n  db\n    .collection(req.params.collectionName)\n    .find({ _id: issueId })\n    .limit(1)\n    .next()\n    .then(event => {\n      res.json({ event });\n    });\n});\n\n/**\n * endpoint for a list of events\n */\napp.get('/api/:collectionName', (req, res) => {\n  db\n    .collection(req.params.collectionName)\n    .find()\n    .toArray()\n    .then(events => {\n      res.json({ events });\n    });\n});\n\napp.get('/api', (req, res) => {\n  res.send('Using the confriends REST API');\n});\n\n// The \"catchall\" handler: for any request that doesn't\n// match one above, send back React's index.html file.\napp.get('*', (req, res) => {\n  res.sendFile(path.join(`${__dirname}../client/build/index.html`));\n});\n"]}